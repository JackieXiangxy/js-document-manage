<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.js.download.manager.mapper.DownloadProcessMapper">
    <resultMap id="BaseResultMap" type="com.js.download.manager.model.DownloadProcess">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 02 12:17:28 CST 2019.
        -->
        <id column="PK_ID" jdbcType="VARCHAR" property="pkId"/>
        <result column="USER_ID" jdbcType="VARCHAR" property="userId"/>
        <result column="ORGINIZE_ID" jdbcType="VARCHAR" property="orginizeId"/>
        <result column="PROCESS_ID" jdbcType="VARCHAR" property="processId"/>
        <result column="DOWNLOAD_FILE_ID" jdbcType="VARCHAR" property="downloadFileId"/>
        <result column="DOWNLOAD_TIME" jdbcType="TIMESTAMP" property="downloadTime"/>
        <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="STATUS" jdbcType="DECIMAL" property="status"/>
        <result column="IS_DELETE" jdbcType="DECIMAL" property="isDelete"/>
        <result column="ACTION_NAME" jdbcType="VARCHAR" property="actionName"/>
        <result column="IP_ADD" jdbcType="VARCHAR" property="ipAdd"/>
        <result column="FILE_TYPE" jdbcType="VARCHAR" property="fileType"/>
        <result column="END_TIME" jdbcType="TIMESTAMP" property="endTime"/>
    </resultMap>
    <sql id="Base_Column_List">

        PK_ID, USER_ID, ORGINIZE_ID, PROCESS_ID, DOWNLOAD_FILE_ID, DOWNLOAD_TIME, UPDATE_TIME,
        STATUS, IS_DELETE, ACTION_NAME, IP_ADD, FILE_TYPE, END_TIME
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">

        select
        <include refid="Base_Column_List"/>
        from DOWNLOAD_PROCESS_CLIENT
        where PK_ID = #{pkId,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 02 12:17:28 CST 2019.
        -->
        delete from DOWNLOAD_PROCESS_CLIENT
        where PK_ID = #{pkId,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.js.download.manager.model.DownloadProcess">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 02 12:17:28 CST 2019.
        -->
        insert into DOWNLOAD_PROCESS_CLIENT (PK_ID, USER_ID, ORGINIZE_ID,
        PROCESS_ID, DOWNLOAD_FILE_ID, DOWNLOAD_TIME,
        UPDATE_TIME, STATUS, IS_DELETE,
        ACTION_NAME, IP_ADD, FILE_TYPE,
        END_TIME)
        values (#{pkId,jdbcType=VARCHAR}, #{userId,jdbcType=VARCHAR}, #{orginizeId,jdbcType=VARCHAR},
        #{processId,jdbcType=VARCHAR}, #{downloadFileId,jdbcType=VARCHAR}, #{downloadTime,jdbcType=TIMESTAMP},
        #{updateTime,jdbcType=TIMESTAMP}, #{status,jdbcType=DECIMAL}, #{isDelete,jdbcType=DECIMAL},
        #{actionName,jdbcType=VARCHAR}, #{ipAdd,jdbcType=VARCHAR}, #{fileType,jdbcType=VARCHAR},
        #{endTime,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.js.download.manager.model.DownloadProcess">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 02 12:17:28 CST 2019.
        -->
        insert into DOWNLOAD_PROCESS_CLIENT
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="pkId != null">
                PK_ID,
            </if>
            <if test="userId != null">
                USER_ID,
            </if>
            <if test="orginizeId != null">
                ORGINIZE_ID,
            </if>
            <if test="processId != null">
                PROCESS_ID,
            </if>
            <if test="downloadFileId != null">
                DOWNLOAD_FILE_ID,
            </if>
            <if test="downloadTime != null">
                DOWNLOAD_TIME,
            </if>
            <if test="updateTime != null">
                UPDATE_TIME,
            </if>
            <if test="status != null">
                STATUS,
            </if>
            <if test="isDelete != null">
                IS_DELETE,
            </if>
            <if test="actionName != null">
                ACTION_NAME,
            </if>
            <if test="ipAdd != null">
                IP_ADD,
            </if>
            <if test="fileType != null">
                FILE_TYPE,
            </if>
            <if test="endTime != null">
                END_TIME,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="pkId != null">
                #{pkId,jdbcType=VARCHAR},
            </if>
            <if test="userId != null">
                #{userId,jdbcType=VARCHAR},
            </if>
            <if test="orginizeId != null">
                #{orginizeId,jdbcType=VARCHAR},
            </if>
            <if test="processId != null">
                #{processId,jdbcType=VARCHAR},
            </if>
            <if test="downloadFileId != null">
                #{downloadFileId,jdbcType=VARCHAR},
            </if>
            <if test="downloadTime != null">
                #{downloadTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="status != null">
                #{status,jdbcType=DECIMAL},
            </if>
            <if test="isDelete != null">
                #{isDelete,jdbcType=DECIMAL},
            </if>
            <if test="actionName != null">
                #{actionName,jdbcType=VARCHAR},
            </if>
            <if test="ipAdd != null">
                #{ipAdd,jdbcType=VARCHAR},
            </if>
            <if test="fileType != null">
                #{fileType,jdbcType=VARCHAR},
            </if>
            <if test="endTime != null">
                #{endTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.js.download.manager.model.DownloadProcess">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 02 12:17:28 CST 2019.
        -->
        update DOWNLOAD_PROCESS_CLIENT
        <set>
            <if test="userId != null">
                USER_ID = #{userId,jdbcType=VARCHAR},
            </if>
            <if test="orginizeId != null">
                ORGINIZE_ID = #{orginizeId,jdbcType=VARCHAR},
            </if>
            <if test="processId != null">
                PROCESS_ID = #{processId,jdbcType=VARCHAR},
            </if>
            <if test="downloadFileId != null">
                DOWNLOAD_FILE_ID = #{downloadFileId,jdbcType=VARCHAR},
            </if>
            <if test="downloadTime != null">
                DOWNLOAD_TIME = #{downloadTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="status != null">
                STATUS = #{status,jdbcType=DECIMAL},
            </if>
            <if test="isDelete != null">
                IS_DELETE = #{isDelete,jdbcType=DECIMAL},
            </if>
            <if test="actionName != null">
                ACTION_NAME = #{actionName,jdbcType=VARCHAR},
            </if>
            <if test="ipAdd != null">
                IP_ADD = #{ipAdd,jdbcType=VARCHAR},
            </if>
            <if test="fileType != null">
                FILE_TYPE = #{fileType,jdbcType=VARCHAR},
            </if>
            <if test="endTime != null">
                END_TIME = #{endTime,jdbcType=TIMESTAMP},
            </if>
        </set>
        where PK_ID = #{pkId,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.js.download.manager.model.DownloadProcess">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 02 12:17:28 CST 2019.
        -->
        update DOWNLOAD_PROCESS_CLIENT
        set USER_ID = #{userId,jdbcType=VARCHAR},
        ORGINIZE_ID = #{orginizeId,jdbcType=VARCHAR},
        PROCESS_ID = #{processId,jdbcType=VARCHAR},
        DOWNLOAD_FILE_ID = #{downloadFileId,jdbcType=VARCHAR},
        DOWNLOAD_TIME = #{downloadTime,jdbcType=TIMESTAMP},
        UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
        STATUS = #{status,jdbcType=DECIMAL},
        IS_DELETE = #{isDelete,jdbcType=DECIMAL},
        ACTION_NAME = #{actionName,jdbcType=VARCHAR},
        IP_ADD = #{ipAdd,jdbcType=VARCHAR},
        FILE_TYPE = #{fileType,jdbcType=VARCHAR},
        END_TIME = #{endTime,jdbcType=TIMESTAMP}
        where PK_ID = #{pkId,jdbcType=VARCHAR}
    </update>

    <select id="selectByUserIdFileId" parameterType="java.lang.String"
            resultType="com.js.download.manager.model.DownloadProcess">
    SELECT * FROM DOWNLOAD_PROCESS_CLIENT WHERE USER_ID=#{userId} AND DOWNLOAD_FILE_ID=#{fileId} AND STATUS=0 OR STATUS=1
  </select>

    <select id="selectByUser" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT * FROM (
        SELECT A.*,B.USERNAME,B.ALARM,C.ORGNAME,C.ORGJC,D.MEDIA_NAME FILENAME,ROWNUM ROWN FROM DOWNLOAD_PROCESS_CLIENT A
        LEFT JOIN SYS_POLICE B ON A.USER_ID=B.ID
        LEFT JOIN SYS_ORGANIZATION C ON A.ORGINIZE_ID=C.ID
        LEFT JOIN JS_MEDIA D ON D.PK_ID=A.DOWNLOAD_FILE_ID
        <where>
            <if test="queryUtils.userId != null">
                A.USER_ID = #{queryUtils.userId,jdbcType=VARCHAR}
            </if>
            <if test="queryUtils.fileType != null">
                AND A.FILE_TYPE = #{queryUtils.fileType,jdbcType=VARCHAR}
            </if>

            <if test="queryUtils.startTime != null">
                AND A.DOWNLOAD_TIME &gt;= to_date(#{queryUtils.startTime},'YYYY-MM-DD HH24:MI:SS')

            </if>

            <if test="queryUtils.endTime != null">
                AND A.DOWNLOAD_TIME &lt;= to_date(#{queryUtils.endTime},'YYYY-MM-DD HH24:MI:SS')
            </if>
            AND ROWNUM &lt;=${endNum}
            ORDER BY A.DOWNLOAD_TIME DESC
        </where>
        ) WHERE ROWN &gt;${startNum}
    </select>

    <select id="getDocNoById" resultType="java.lang.String" parameterType="java.lang.String">
        SELECT DOC_NO FROM JS_DOC WHERE ID=#{id}
    </select>

    <select id="getMediaNameById" resultType="java.lang.String" parameterType="java.lang.String">
       SELECT MEDIA_NAME FROM JS_MEDIA   WHERE PK_ID=#{id}
    </select>

    <select id="getTotalNum" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM(
        SELECT A.*,B.USERNAME,B.ALARM,C.ORGNAME,C.ORGJC,D.MEDIA_NAME FILENAME,ROWNUM FROM DOWNLOAD_PROCESS_CLIENT A
        LEFT JOIN SYS_POLICE B ON A.USER_ID=B.ID
        LEFT JOIN SYS_ORGANIZATION C ON A.ORGINIZE_ID=C.ID
        LEFT JOIN JS_MEDIA D ON D.PK_ID=A.DOWNLOAD_FILE_ID
        <where>
            <if test="queryUtils.userId != null">
                A.USER_ID = #{queryUtils.userId,jdbcType=VARCHAR}
            </if>
            <if test="queryUtils.fileType != null">
                AND A.FILE_TYPE = #{queryUtils.fileType,jdbcType=VARCHAR}
            </if>

            <if test="queryUtils.startTime != null">
                AND A.DOWNLOAD_TIME &gt;= to_date(#{queryUtils.startTime},'YYYY-MM-DD HH24:MI:SS')

            </if>

            <if test="queryUtils.endTime != null">
                AND A.DOWNLOAD_TIME &lt;= to_date(#{queryUtils.endTime},'YYYY-MM-DD HH24:MI:SS')
            </if>
        </where>
        )

    </select>

</mapper>